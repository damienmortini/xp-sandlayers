(function(){"use strict";function e(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function t(e,t,n,a,r,i,d,o,s,l,_,m,u,c,p,g,f){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e[4]=i,e[5]=d,e[6]=o,e[7]=s,e[8]=l,e[9]=_,e[10]=m,e[11]=u,e[12]=c,e[13]=p,e[14]=g,e[15]=f,e}function n(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function a(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=t[4],o=t[5],s=t[6],l=t[7],_=t[8],m=t[9],u=t[10],c=t[11],p=t[12],g=t[13],f=t[14],h=t[15],v=n*o-a*d,E=n*s-r*d,x=n*l-i*d,y=a*s-r*o,b=a*l-i*o,T=r*l-i*s,S=_*g-m*p,w=_*f-u*p,P=_*h-c*p,B=m*f-u*g,R=m*h-c*g,C=u*h-c*f,A=v*C-E*R+x*B+y*P-b*w+T*S;return A?(A=1/A,e[0]=(o*C-s*R+l*B)*A,e[1]=(r*R-a*C-i*B)*A,e[2]=(g*T-f*b+h*y)*A,e[3]=(u*b-m*T-c*y)*A,e[4]=(s*P-d*C-l*w)*A,e[5]=(n*C-r*P+i*w)*A,e[6]=(f*x-p*T-h*E)*A,e[7]=(_*T-u*x+c*E)*A,e[8]=(d*R-o*P+l*S)*A,e[9]=(a*P-n*R-i*S)*A,e[10]=(p*b-g*x+h*v)*A,e[11]=(m*x-_*b-c*v)*A,e[12]=(o*w-d*B-s*S)*A,e[13]=(n*B-a*w+r*S)*A,e[14]=(g*E-p*y-f*v)*A,e[15]=(_*y-m*E+u*v)*A,e):null}function r(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],m=t[8],u=t[9],c=t[10],p=t[11],g=t[12],f=t[13],h=t[14],v=t[15],E=n[0],x=n[1],y=n[2],b=n[3];return e[0]=E*a+x*o+y*m+b*g,e[1]=E*r+x*s+y*u+b*f,e[2]=E*i+x*l+y*c+b*h,e[3]=E*d+x*_+y*p+b*v,E=n[4],x=n[5],y=n[6],b=n[7],e[4]=E*a+x*o+y*m+b*g,e[5]=E*r+x*s+y*u+b*f,e[6]=E*i+x*l+y*c+b*h,e[7]=E*d+x*_+y*p+b*v,E=n[8],x=n[9],y=n[10],b=n[11],e[8]=E*a+x*o+y*m+b*g,e[9]=E*r+x*s+y*u+b*f,e[10]=E*i+x*l+y*c+b*h,e[11]=E*d+x*_+y*p+b*v,E=n[12],x=n[13],y=n[14],b=n[15],e[12]=E*a+x*o+y*m+b*g,e[13]=E*r+x*s+y*u+b*f,e[14]=E*i+x*l+y*c+b*h,e[15]=E*d+x*_+y*p+b*v,e}function i(e,t,n){let a,r,i,d,o,s,l,_,m,u,c,p,g=n[0],f=n[1],h=n[2];return t===e?(e[12]=t[0]*g+t[4]*f+t[8]*h+t[12],e[13]=t[1]*g+t[5]*f+t[9]*h+t[13],e[14]=t[2]*g+t[6]*f+t[10]*h+t[14],e[15]=t[3]*g+t[7]*f+t[11]*h+t[15]):(a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],m=t[8],u=t[9],c=t[10],p=t[11],e[0]=a,e[1]=r,e[2]=i,e[3]=d,e[4]=o,e[5]=s,e[6]=l,e[7]=_,e[8]=m,e[9]=u,e[10]=c,e[11]=p,e[12]=a*g+o*f+m*h+t[12],e[13]=r*g+s*f+u*h+t[13],e[14]=i*g+l*f+c*h+t[14],e[15]=d*g+_*f+p*h+t[15]),e}function d(e,t,n){let a=n[0],r=n[1],i=n[2];return e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e[3]=t[3]*a,e[4]=t[4]*r,e[5]=t[5]*r,e[6]=t[6]*r,e[7]=t[7]*r,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function o(e,t,n){let a=ve(n),r=he(n),i=t[4],d=t[5],o=t[6],s=t[7],l=t[8],_=t[9],m=t[10],u=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=i*r+l*a,e[5]=d*r+_*a,e[6]=o*r+m*a,e[7]=s*r+u*a,e[8]=l*r-i*a,e[9]=_*r-d*a,e[10]=m*r-o*a,e[11]=u*r-s*a,e}function s(e,t,n){let a=ve(n),r=he(n),i=t[0],d=t[1],o=t[2],s=t[3],l=t[8],_=t[9],m=t[10],u=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r-l*a,e[1]=d*r-_*a,e[2]=o*r-m*a,e[3]=s*r-u*a,e[8]=i*a+l*r,e[9]=d*a+_*r,e[10]=o*a+m*r,e[11]=s*a+u*r,e}function l(e,t,n){let a=ve(n),r=he(n),i=t[0],d=t[1],o=t[2],s=t[3],l=t[4],_=t[5],m=t[6],u=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=i*r+l*a,e[1]=d*r+_*a,e[2]=o*r+m*a,e[3]=s*r+u*a,e[4]=l*r-i*a,e[5]=_*r-d*a,e[6]=m*r-o*a,e[7]=u*r-s*a,e}function _(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n+n,o=a+a,s=r+r,l=n*d,_=a*d,m=a*o,u=r*d,c=r*o,p=r*s,g=i*d,f=i*o,h=i*s;return e[0]=1-m-p,e[1]=_+h,e[2]=u-f,e[3]=0,e[4]=_-h,e[5]=1-l-p,e[6]=c+g,e[7]=0,e[8]=u+f,e[9]=c-g,e[10]=1-l-m,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function m(e,t,n,a,r){let i=1/Math.tan(t/2),d=1/(a-r);return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(r+a)*d,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*r*a*d,e[15]=0,e}function u(){let e=new Re(2);return e[0]=0,e[1]=0,e}function c(e,t){return e[0]=t[0],e[1]=t[1],e}function p(e,t,n){return e[0]=t,e[1]=n,e}function g(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e}function f(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e}function h(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e}function v(e){var t=e[0],n=e[1];return fe(t*t+n*n)}function E(e){var t=e[0],n=e[1];return t*t+n*n}function x(e,t){return e[0]=-t[0],e[1]=-t[1],e}function y(e,t){var n=t[0],a=t[1],r=n*n+a*a;return 0<r&&(r=1/fe(r),e[0]=t[0]*r,e[1]=t[1]*r),e}function b(e,t){return e[0]*t[0]+e[1]*t[1]}function T(e,t,n){var a=t[0]*n[1]-t[1]*n[0];return e[0]=e[1]=0,e[2]=a,e}function S(e,n,a,r){var t=n[0],i=n[1];return e[0]=t+r*(a[0]-t),e[1]=i+r*(a[1]-i),e}function w(e,t,n){var a=t[0],r=t[1];return e[0]=n[0]*a+n[3]*r+n[6],e[1]=n[1]*a+n[4]*r+n[7],e}function P(e,t,n){let a=t[0],r=t[1];return e[0]=n[0]*a+n[4]*r+n[12],e[1]=n[1]*a+n[5]*r+n[13],e}function B(e,t){return e[0]===t[0]&&e[1]===t[1]}function R(){let e=new Re(3);return e[0]=0,e[1]=0,e[2]=0,e}function C(e){let t=e[0],n=e[1],a=e[2];return fe(t*t+n*n+a*a)}function A(e,t,n){let a=new Re(3);return a[0]=e,a[1]=t,a[2]=n,a}function z(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function L(e,t,n,a){return e[0]=t,e[1]=n,e[2]=a,e}function D(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function F(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function I(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function U(e,t){let n=t[0]-e[0],a=t[1]-e[1],r=t[2]-e[2];return fe(n*n+a*a+r*r)}function M(e){let t=e[0],n=e[1],a=e[2];return t*t+n*n+a*a}function k(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function N(e,t){let n=t[0],a=t[1],r=t[2],i=n*n+a*a+r*r;return 0<i&&(i=1/fe(i),e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i),e}function O(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function Y(e,t,n){let a=t[0],r=t[1],i=t[2],d=n[0],o=n[1],s=n[2];return e[0]=r*s-i*o,e[1]=i*d-a*s,e[2]=a*o-r*d,e}function j(e,t,n){let a=t[0],r=t[1],i=t[2],d=n[3]*a+n[7]*r+n[11]*i+n[15];return d=d||1,e[0]=(n[0]*a+n[4]*r+n[8]*i+n[12])/d,e[1]=(n[1]*a+n[5]*r+n[9]*i+n[13])/d,e[2]=(n[2]*a+n[6]*r+n[10]*i+n[14])/d,e}function V(e,t){let n=A(e[0],e[1],e[2]),a=A(t[0],t[1],t[2]);N(n,n),N(a,a);let r=O(n,a);return 1<r?0:-1>r?Ee:pe(r)}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function H(){let e=new Re(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function W(e,t,n,a,r){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e}function X(){let e=new Re(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function Q(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}function q(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function K(e,t,n,a,r,i,d,o,s,l){return e[0]=t,e[1]=n,e[2]=a,e[3]=r,e[4]=i,e[5]=d,e[6]=o,e[7]=s,e[8]=l,e}function Z(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function $(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=t[4],o=t[5],s=t[6],l=t[7],_=t[8],m=_*d-o*l,u=-_*i+o*s,c=l*i-d*s,p=n*m+a*u+r*c;return p?(p=1/p,e[0]=m*p,e[1]=(-_*a+r*l)*p,e[2]=(o*a-r*d)*p,e[3]=u*p,e[4]=(_*n-r*s)*p,e[5]=(-o*n+r*i)*p,e[6]=c*p,e[7]=(-l*n+a*s)*p,e[8]=(d*n-a*i)*p,e):null}function J(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],m=t[8],u=n[0],c=n[1],p=n[2],g=n[3],f=n[4],h=n[5],v=n[6],E=n[7],x=n[8];return e[0]=u*a+c*d+p*l,e[1]=u*r+c*o+p*_,e[2]=u*i+c*s+p*m,e[3]=g*a+f*d+h*l,e[4]=g*r+f*o+h*_,e[5]=g*i+f*s+h*m,e[6]=v*a+E*d+x*l,e[7]=v*r+E*o+x*_,e[8]=v*i+E*s+x*m,e}function ee(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],s=t[5],l=t[6],_=t[7],m=t[8],u=n[0],c=n[1];return e[0]=a,e[1]=r,e[2]=i,e[3]=d,e[4]=o,e[5]=s,e[6]=u*a+c*d+l,e[7]=u*r+c*o+_,e[8]=u*i+c*s+m,e}function te(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=t[4],l=t[5],_=t[6],m=t[7],u=t[8],p=ve(n),s=he(n);return e[0]=s*a+p*d,e[1]=s*r+p*o,e[2]=s*i+p*l,e[3]=s*d-p*a,e[4]=s*o-p*r,e[5]=s*l-p*i,e[6]=_,e[7]=m,e[8]=u,e}function ne(e,t,n){let a=n[0],r=n[1];return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=r*t[3],e[4]=r*t[4],e[5]=r*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ae(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n+n,o=a+a,s=r+r,l=n*d,_=a*d,m=a*o,u=r*d,c=r*o,p=r*s,g=i*d,f=i*o,h=i*s;return e[0]=1-m-p,e[3]=_-h,e[6]=u+f,e[1]=_+h,e[4]=1-l-p,e[7]=c-g,e[2]=u-f,e[5]=c+g,e[8]=1-l-m,e}function re(){let e=new Re(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function ie(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function de(e,t,n){n*=.5;let a=ve(n);return e[0]=a*t[0],e[1]=a*t[1],e[2]=a*t[2],e[3]=he(n),e}function oe(e,t,n){let a=t[0],r=t[1],i=t[2],d=t[3],o=n[0],s=n[1],l=n[2],_=n[3];return e[0]=a*_+d*o+r*l-i*s,e[1]=r*_+d*s+i*o-a*l,e[2]=i*_+d*l+a*s-r*o,e[3]=d*_-a*o-r*s-i*l,e}function se(e,t,n){n*=.5;let a=t[0],r=t[1],i=t[2],d=t[3],o=ve(n),s=he(n);return e[0]=a*s+d*o,e[1]=r*s+i*o,e[2]=i*s-r*o,e[3]=d*s-a*o,e}function le(e,t,n){n*=.5;let a=t[0],r=t[1],i=t[2],d=t[3],o=ve(n),s=he(n);return e[0]=a*s-i*o,e[1]=r*s+d*o,e[2]=i*s+a*o,e[3]=d*s-r*o,e}function _e(e,t,n){n*=.5;let a=t[0],r=t[1],i=t[2],d=t[3],o=ve(n),s=he(n);return e[0]=a*s+r*o,e[1]=r*s-a*o,e[2]=i*s+d*o,e[3]=d*s-i*o,e}function me(e,n,a,r){let t,i,d,o,s,l=n[0],_=n[1],m=n[2],u=n[3],c=a[0],p=a[1],g=a[2],f=a[3];return i=l*c+_*p+m*g+u*f,0>i&&(i=-i,c=-c,p=-p,g=-g,f=-f),1e-6<1-i?(t=pe(i),d=ve(t),o=ve((1-r)*t)/d,s=ve(r*t)/d):(o=1-r,s=r),e[0]=o*l+s*c,e[1]=o*_+s*p,e[2]=o*m+s*g,e[3]=o*u+s*f,e}function ue(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n*n+a*a+r*r+i*i,o=d?1/d:0;return e[0]=-n*o,e[1]=-a*o,e[2]=-r*o,e[3]=i*o,e}function ce(e,t){let n,a=t[0]+t[4]+t[8];if(0<a)n=fe(a+1),e[3]=.5*n,n=.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let a=0;t[4]>t[0]&&(a=1),t[8]>t[3*a+a]&&(a=2);let r=(a+1)%3,i=(a+2)%3;n=fe(t[3*a+a]-t[3*r+r]-t[3*i+i]+1),e[a]=.5*n,n=.5/n,e[3]=(t[3*r+i]-t[3*i+r])*n,e[r]=(t[3*r+a]+t[3*a+r])*n,e[i]=(t[3*i+a]+t[3*a+i])*n}return e}var pe=Math.acos,ge=Math.min,fe=Math.sqrt,he=Math.cos,ve=Math.sin,Ee=Math.PI;class xe extends Set{constructor(){super(),this._onceCallbacks=new Set}add(e,{once:t=!1}={}){t&&this._onceCallbacks.add(e),super.add(e)}dispatch(e){for(let t of this)t(e),this._onceCallbacks.has(t)&&(this._onceCallbacks.delete(t),this.delete(t))}}var ye=new class extends xe{constructor(){super(),this._updateBinded=this.update.bind(this),this._previousTimestamp=window.performance.now(),this.deltaTime=0,this.timeScale=1,this.update()}update(e){requestAnimationFrame(this._updateBinded);const t=window.performance.now();this.deltaTime=.001*(t-this._previousTimestamp),this.timeScale=this.deltaTime/.0166666667,this._previousTimestamp=t,this.dispatch(e)}};class be extends HTMLElement{constructor({autoplay:e=!1,background:t=!1}={}){super(),this._autoplay=e||this.hasAttribute("autoplay"),this._background=t||this.hasAttribute("background"),this.paused=!0,this._pausedByBlur=!1,this._updateBinded=this.update.bind(this)}connectedCallback(){this._background||(window.top.addEventListener("blur",this._onBlur=()=>{this._pausedByBlur=!this.paused,this.pause()}),window.top.addEventListener("focus",this._onFocus=()=>{this._pausedByBlur&&this.play()})),window.top.document.hasFocus()&&this._autoplay?this.play():this._autoplay&&(this._pausedByBlur=!0,requestAnimationFrame(this._updateBinded))}disconnectedCallback(){this.pause(),window.top.removeEventListener("blur",this._onBlur),window.top.removeEventListener("focus",this._onFocus)}play(){this.paused=!1,this._pausedByBlur=!1,ye.add(this._updateBinded),this.dispatchEvent(new Event("playing"))}pause(){this.paused=!0,ye.delete(this._updateBinded),this.dispatchEvent(new Event("pause"))}update(){}}window.customElements.define("dlib-loop",be);let Te="";const Se=new Map,we=new Map,Pe=new Map([["text",new Set(["txt","html","js","svg"])],["json",new Set(["json"])],["binary",new Set(["bin"])],["image",new Set(["png","jpg","gif"])],["video",new Set(["mp4","webm"])],["audio",new Set(["mp3","ogg"])],["style",new Set(["css"])],["font",new Set(["woff","woff2","ttf"])]]);class Be{static get onLoad(){return Promise.all(Se.values())}static get promises(){return Se}static get typeMap(){return Pe}static get(e){return we.get(e)}static get baseURI(){return Te}static set baseURI(e){Te=e}static load(e){const t=e instanceof Array;t||(e=[e]);let n=[];for(let t of e){if(!t)continue;let e;"object"==typeof t&&(e=t.type,t=t.value);const a=`${Te}${"string"==typeof t?t:t.href||t.src}`,r=/[\\/](.*)\.(.*)$/.exec(a)[2];if(!e)for(const[t,n]of Pe)if(n.has(r)){e=t;break}let i=new Promise(function(n){return Se.get(t)?void Se.get(t).then(n):Be.get(t)?void n(Be.get(t)):void fetch(`${Te}${a}`).catch(()=>new Promise(function(e){const t=new XMLHttpRequest;t.onload=function(){e(new Response(t.responseText,{status:t.status}))},t.open("GET",`${Te}${a}`),t.send(null)})).then((n)=>"text"===e?n.text():"json"===e?n.json():"binary"===e?n.arrayBuffer():"image"===e?new Promise((e)=>{const t=document.createElement("img");t.onload=()=>{e(t)},t.src=a}):"video"===e||"audio"===e?new Promise((t)=>{const n=document.createElement(e);n.oncanplaythrough=()=>{t(n)},n.src=a}):"style"===e?new Promise((e)=>{const t=document.createElement("link");t.rel="stylesheet",t.type="text/css",t.onload=()=>{e(t)},document.head.appendChild(t),t.href=a}):"font"===e?new Promise(()=>{let e=new FontFace(/([^\/]*)\.(woff|woff2|ttf)$/.exec(t)[1],`url("${t}")`);return document.fonts.add(e),e.load()}):"template"===e?n.text().then((e)=>{const t=document.createElement("template");return t.innerHTML=e,t}):n.blob()).then((e)=>{Se.delete(t),we.set(t,e),n(e)})});n.push(i),Se.set(t,i)}return t?Promise.all(n):n[0]}}let Re="undefined"==typeof Float32Array?Array:Float32Array;class Ce extends Float32Array{constructor(e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]){return super(e),this}set x(e){this[12]=e}get x(){return this[12]}set y(e){this[13]=e}get y(){return this[13]}set z(e){this[14]=e}get z(){return this[14]}set w(e){this[15]=e}get w(){return this[15]}set(e,n,a,r,i,d,o,s,l,_,m,u,c,p,g,f){return e.length?this.copy(e):(t(this,e,n,a,r,i,d,o,s,l,_,m,u,c,p,g,f),this)}translate(e,t=this){return i(this,t,e),this}rotateX(e,t=this){return o(this,t,e),this}rotateY(e,t=this){return s(this,t,e),this}rotateZ(e,t=this){return l(this,t,e),this}scale(e,t=this){return d(this,t,"number"==typeof e?[e,e,e]:e),this}multiply(e,t){return t?r(this,e,t):r(this,this,e),this}identity(){return n(this),this}copy(t){return e(this,t),this}fromPerspective({fov:e,aspectRatio:t,near:n,far:a}={}){return m(this,e,t,n,a),this}fromQuaternion(e){return _(this,e),this}setPosition(e){return this.x=e[0],this.y=e[1],this.z=e[2],this}invert(e=this){return a(this,e),this}}(function(){let e=u();return function(t,n,a,r,d,o){let s,i;for(n||(n=2),a||(a=0),i=r?ge(r*n+a,t.length):t.length,s=a;s<i;s+=n)e[0]=t[s],e[1]=t[s+1],d(e,e,o),t[s]=e[0],t[s+1]=e[1];return t}})();class Ae extends Float32Array{constructor(e=0,t=0){return super(2),this.set(e,t),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}set(e,t){return p(this,e,t),this}copy(e){return c(this,e),this}add(e){return g(this,this,e),this}get size(){return v(this)}get squaredSize(){return E(this)}subtract(e){return f(this,this,e),this}negate(e=this){return x(this,e),this}cross(e,t){return T(this,e,t),this}scale(e){return h(this,this,e),this}normalize(){y(this,this)}dot(e){return b(this,e)}equals(e){return B(this,e)}applyMatrix3(e){return w(this,this,e),this}applyMatrix4(e){return P(this,this,e),this}lerp(e,t){S(this,this,e,t)}clone(){return new Ae(this.x,this.y)}}(function(){let e=R();return function(t,n,a,r,d,o){let s,i;for(n||(n=3),a||(a=0),i=r?ge(r*n+a,t.length):t.length,s=a;s<i;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],d(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2];return t}})();class ze extends Float32Array{constructor(e=[0,0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}set(e,t,n){return L(this,e,t,n),this}copy(e){return z(this,e),this}add(e){return D(this,this,e),this}get size(){return C(this)}get squaredSize(){return M(this)}distance(e){return U(this,e)}subtract(e){return F(this,this,e),this}negate(e=this){return k(this,e),this}cross(e,t){return Y(this,e,t),this}scale(e){return I(this,this,e),this}normalize(){return N(this,this),this}dot(e){return O(this,e)}equals(e){return G(this,e)}applyMatrix4(e){return j(this,this,e),this}angle(e){return V(this,e)}clone(){return new ze(this.x,this.y,this.z)}}(function(){let e=H();return function(t,n,a,r,d,o){let s,i;for(n||(n=4),a||(a=0),i=r?ge(r*n+a,t.length):t.length,s=a;s<i;s+=n)e[0]=t[s],e[1]=t[s+1],e[2]=t[s+2],e[3]=t[s+3],d(e,e,o),t[s]=e[0],t[s+1]=e[1],t[s+2]=e[2],t[s+3]=e[3];return t}})();class Le extends Float32Array{constructor(e=[0,0,0,0]){return super(e),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}set(e,t,n,a){return W(this,e,t,n,a),this}}class De extends Float32Array{constructor(e=[1,0,0,0,1,0,0,0,1]){return super(e),this}set(e,t,n,a,r,i,d,o,s){return K(this,e,t,n,a,r,i,d,o,s),this}translate(e,t=this){return ee(this,t,e),this}rotate(e,t=this){return te(this,t,e),this}scale(e,t=this){return ne(this,t,e),this}multiply(e,t){return t?J(this,e,t):J(this,this,e),this}identity(){return Z(this),this}copy(e){return q(this,e),this}fromMatrix4(e){return Q(this,e),this}fromQuaternion(e){return ae(this,e),this}fromBasis(e,t,n){return this.set(e[0],e[1],e[2],t[0],t[1],t[2],n[0],n[1],n[2]),this}invert(e=this){return $(this,e),this}}class Fe{static add(e="void main() {}",t){for(let[n,a]of t)e="start"===n?e.replace(/(#version .*?)\n([\s\S]*)/,`$1\n${a}\n$2`):"end"===n?e.replace(/(}\s*$)/,`\n${a}\n$1`):"main"===n?e.replace(/(\bvoid\b +\bmain\b[\s\S]*?{\s*)/,`$1\n${a}\n`):e.replace(n,a);return e}constructor({vertexShader:e=`#version 300 es
    void main() {
      gl_Position = vec4(0., 0., 0., 1.);
    }
  `,fragmentShader:t=`#version 300 es
    precision highp float;

    out vec4 fragColor;

    void main() {
      fragColor = vec4(1.);
    }
  `,uniforms:n=[],vertexShaderChunks:a=[],fragmentShaderChunks:r=[],shaders:i=[]}={}){this.uniforms=new Map,this.uniformTypes=new Map,this.vertexShader=e,this.fragmentShader=t,this._vertexShaderChunks=[],this._fragmentShaderChunks=[],this.add({vertexShaderChunks:a,fragmentShaderChunks:r,uniforms:n});for(let d of i)this.add(d)}add({vertexShaderChunks:e=[],fragmentShaderChunks:t=[],uniforms:n=[]}={}){this.vertexShader=Fe.add(this.vertexShader,e),this._vertexShaderChunks.push(...e),this.fragmentShader=Fe.add(this.fragmentShader,t),this._fragmentShaderChunks.push(...t);for(let[a,r]of n)this.uniforms.set(a,r)}set vertexShader(e){this._vertexShader=e,this._parseUniforms(this._vertexShader)}get vertexShader(){return this._vertexShader}set fragmentShader(e){this._fragmentShader=e,this._parseUniforms(this._fragmentShader)}get fragmentShader(){return this._fragmentShader}get vertexShaderChunks(){return this._vertexShaderChunks}get fragmentShaderChunks(){return this._fragmentShaderChunks}_parseUniforms(e,t){t=Object.assign({Vector2:class extends Float32Array{constructor(){super(2)}},Vector3:class extends Float32Array{constructor(){super(3)}},Vector4:class extends Float32Array{constructor(){super(4)}},Matrix3:class extends Float32Array{constructor(){super([1,0,0,0,1,0,0,0,1])}},Matrix4:class extends Float32Array{constructor(){super([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}},Texture:class{},TextureCube:class{}},t);for(let n,a=/^\s*uniform (.[^ ]+) (.[^ ;\[\]]+)\[? *(\d+)? *\]?/gm;n=a.exec(e);){let[,e,a,r]=n,i=parseInt(r);if(this.uniforms.has(a))continue;let d,o;if(this.uniformTypes.set(a,e),/float|double/.test(e))d=isNaN(i)?0:Array(i).fill(0);else if(/int|uint/.test(e))d=isNaN(i)?0:Array(i).fill(0);else if(/sampler2D/.test(e))d=isNaN(i)?new t.Texture:Array(i).fill().map(()=>new t.Texture);else if(/samplerCube/.test(e))d=isNaN(i)?new t.TextureCube:Array(i).fill().map(()=>new t.TextureCube);else if(o=/(.?)vec(\d)/.exec(e)){let e=o[2];d=isNaN(i)?new t[`Vector${e}`]:Array(i).fill().map(()=>new t[`Vector${e}`])}else if(o=/mat(\d)/.exec(e)){let e=o[1];d=isNaN(i)?new t[`Matrix${e}`]:Array(i).fill().map(()=>new t[`Matrix${e}`])}else d=void 0;this.uniforms.set(a,d)}}}class Ie{constructor({gl:e,data:t=null,width:n=void 0,height:a=void 0,target:r=t&&t.length?e.TEXTURE_CUBE_MAP:e.TEXTURE_2D,level:i=0,internalformat:d=e.RGBA,format:o=e.RGBA,type:s=e.UNSIGNED_BYTE,minFilter:l=e.NEAREST_MIPMAP_LINEAR,magFilter:_=e.LINEAR,wrapS:m=e.REPEAT,wrapT:u=e.REPEAT}={}){this.gl=e,this._texture=this.gl.createTexture(),this._width=n,this._height=a,this._dataWidth=void 0,this._dataHeight=void 0,this._target=r,this.level=i,this.internalformat=d,this.format=o,this.type=s,this.minFilter=l,this.magFilter=_,this.wrapS=m,this.wrapT=u,this.data=t}generateMipmap(){this.bind(),this.gl.generateMipmap(this._target),this.unbind()}set data(e){if(this._data=e,this._data||this._width&&this._height){const e=this._data&&this._data.length?this._data:[this._data];e[0]&&(this._dataWidth=e[0].width||e[0].videoWidth,this._dataHeight=e[0].height||e[0].videoHeight);const t=this._target===this.gl.TEXTURE_CUBE_MAP?6:1,n=this._target===this.gl.TEXTURE_CUBE_MAP?this.gl.TEXTURE_CUBE_MAP_POSITIVE_X:this._target;this.bind();for(let t=0;t<e.length;t++)this.gl.getParameter(this.gl.VERSION).startsWith("WebGL 1.0")&&this._dataWidth?this.gl.texImage2D(n+t,this.level,this.internalformat,this.format,this.type,e[t]):this.gl.texImage2D(n+t,this.level,this.internalformat,this.width,this.height,0,this.format,this.type,e[t]);this.unbind()}}get data(){return this._data}set width(e){this._width=e,this.data=this.data}get width(){return this._width||this._dataWidth}set height(e){this._height=e,this.data=this.data}get height(){return this._height||this._dataHeight}set minFilter(e){this._minFilter===e||(this._minFilter=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MIN_FILTER,this._minFilter),this.unbind())}get minFilter(){return this._minFilter}set magFilter(e){this._magFilter===e||(this._magFilter=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_MAG_FILTER,this._magFilter),this.unbind())}get magFilter(){return this._magFilter}set wrapS(e){this._wrapS===e||(this._wrapS=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_S,this._wrapS),this.unbind())}get wrapS(){return this._wrapS}set wrapT(e){this._wrapT===e||(this._wrapT=e,this.bind(),this.gl.texParameteri(this._target,this.gl.TEXTURE_WRAP_T,this._wrapT),this.unbind())}get wrapT(){return this._wrapT}bind({unit:e=0}={}){this.gl.activeTexture(this.gl[`TEXTURE${e}`]),this.gl.bindTexture(this._target,this._texture)}unbind(){this.gl.bindTexture(this._target,null)}}class Ue extends Fe{constructor({gl:e,vertexShader:t=void 0,fragmentShader:n=void 0,uniforms:a=void 0,attributes:r=void 0,vertexShaderChunks:i=void 0,fragmentShaderChunks:d=void 0,shaders:o=void 0}={}){super({vertexShader:t,fragmentShader:n,uniforms:a,attributes:r,vertexShaderChunks:i,fragmentShaderChunks:d,shaders:o}),this.gl=e,this._program=e.createProgram(),this._attachedShaders=new Map;const s=this;this._vertexAttribDivisor=function(){};const l=this.gl.getExtension("ANGLE_instanced_arrays");l?this._vertexAttribDivisor=l.vertexAttribDivisorANGLE.bind(l):this.gl.vertexAttribDivisor&&(this._vertexAttribDivisor=this.gl.vertexAttribDivisor.bind(this.gl)),this._attributesLocations=new Map;class _ extends Map{set(t,{buffer:n,location:r=s._attributesLocations.get(t),size:a,type:i=e.FLOAT,normalized:d=!1,stride:o=0,offset:l=0,divisor:_=0}={}){if(t instanceof Map){for(let[e,n]of t)this.set(e,n);return}n.bind(),r===void 0&&(r=e.getAttribLocation(s._program,t),-1===r&&console.warn(`Attribute "${t}" is missing or never used`),s._attributesLocations.set(t,r)),e.enableVertexAttribArray(r),e.vertexAttribPointer(r,a,i,d,o,l),n.unbind(),s._vertexAttribDivisor(r,_),super.set(t,{buffer:n,size:a,type:i,normalized:d,stride:o,offset:l})}}this._uniformLocations=new Map;class m extends Map{set(t,...n){let a=n[0];if(void 0===a)return;let r=s._uniformLocations.get(t);if(void 0===r&&(r=e.getUniformLocation(s._program,t),s._uniformLocations.set(t,r)),void 0===a.length){if(a instanceof Object){for(let e in a)s.uniforms.set(`${t}.${e}`,a[e]);return}1<n.length?(a=s.uniforms.get(t),a.set(...n)):a=n}else if(a[0]instanceof Object){for(let e=0;e<a.length;e++)if(a[0].length)s.uniforms.set(`${t}[${e}]`,a[e]);else for(let n in a[e])s.uniforms.set(`${t}[${e}].${n}`,a[e][n]);return}if(null!==r){const n=s.uniformTypes.get(t);"float"===n?e.uniform1fv(r,a):"vec2"===n?e.uniform2fv(r,a):"vec3"===n?e.uniform3fv(r,a):"vec4"===n?e.uniform4fv(r,a):"int"===n||"sampler2D"===n||"samplerCube"===n?e.uniform1iv(r,a):"ivec2"===n?e.uniform2iv(r,a):"ivec3"===n?e.uniform3iv(r,a):"ivec4"===n?e.uniform4iv(r,a):"mat3"===n?e.uniformMatrix3fv(r,!1,a):"mat4"===n&&e.uniformMatrix4fv(r,!1,a),super.set(t,a)}}}this.vertexShader=this.vertexShader,this.fragmentShader=this.fragmentShader,this.use(),this.attributes=new _;const u=this.uniforms;this.uniforms=new m;for(const[s,l]of u)this.uniforms.set(s,l)}set vertexShader(e){super.vertexShader=e,this.gl&&this._updateShader(this.gl.VERTEX_SHADER,this.vertexShader)}get vertexShader(){return super.vertexShader}set fragmentShader(e){super.fragmentShader=e,this.gl&&this._updateShader(this.gl.FRAGMENT_SHADER,this.fragmentShader)}get fragmentShader(){return super.fragmentShader}use(){this.gl.useProgram(this._program)}_updateShader(e,t){if(t){if(this.gl.getParameter(this.gl.VERSION).startsWith("WebGL 1.0"))if(t=t.replace(/#version.*?\n/g,""),t=t.replace(/\btexture\b/g,"texture2D"),e===this.gl.VERTEX_SHADER)t=t.replace(/\bin\b/g,"attribute"),t=t.replace(/\bout\b/g,"varying");else{t=t.replace(/\bin\b/g,"varying");const e=/out vec4 (.*?);/.exec(t);if(e){const n=e[1];t=t.replace(/out.*?;/,""),t=t.replace(new RegExp(`\\b${n}\\b`,"g"),"gl_FragColor")}}const n=this.gl.createShader(e);this.gl.shaderSource(n,t),this.gl.compileShader(n);const a=this.gl.getShaderInfoLog(n);if(!this.gl.getShaderParameter(n,this.gl.COMPILE_STATUS)){const e=/ERROR: 0:(\d+):/.exec(a);if(e){const n=parseFloat(e[1]),r=t.split("\n");console.error(`${a}\nat: ${r[n-1].replace(/^\s*/,"")}`)}else console.error(a);return void this.gl.deleteShader(n)}a&&console.warn(a);const r=this._attachedShaders.get(e);if(r&&(this.gl.detachShader(this._program,r),this.gl.deleteShader(r)),this.gl.attachShader(this._program,n),this.gl.deleteShader(n),this._attachedShaders.set(e,n),2===this._attachedShaders.size){this.gl.linkProgram(this._program);const e=this.gl.getProgramInfoLog(this._program);this.gl.getProgramParameter(this._program,this.gl.LINK_STATUS)?e&&console.warn(e):console.error(e),this._attributesLocations=new Map,this._uniformLocations=new Map}}}_parseUniforms(e){super._parseUniforms(e,{Vector2:Ae,Vector3:ze,Vector4:Le,Matrix3:De,Matrix4:Ce,GLTexture:Ie})}}class Me{constructor({gl:e,size:t=0,data:n=new ArrayBuffer(t),target:a=e.ARRAY_BUFFER,usage:r=e.STATIC_DRAW}={}){this.gl=e,this._target=a,this._usage=r,this._buffer=this.gl.createBuffer(),this.data=n}set data(e){this._data=e,this.bind(),this.gl.bufferData(this._target,this._data,this._usage),this.unbind()}get data(){return this._data}bind(){this.gl.bindBuffer(this._target,this._buffer)}unbind(){this.gl.bindBuffer(this._target,null)}}class ke{constructor({gl:e,attributes:t,indiceData:n}={}){this.gl=e,this.gl.getExtension("OES_element_index_uint"),this._drawElementsInstanced=function(){},this._drawArraysInstanced=function(){};const a=this.gl.getExtension("ANGLE_instanced_arrays");a?(this._drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a)):this.gl.drawElementsInstanced&&(this._drawElementsInstanced=this.gl.drawElementsInstanced.bind(this.gl),this._drawArraysInstanced=this.gl.drawArraysInstanced.bind(this.gl)),this.attributes=new Map(t);for(let[a,r]of this.attributes)r.buffer=new Me({gl:this.gl,data:r.data}),r.count=r.count||r.data.length/r.size;n&&(this.indices={buffer:new Me({gl:this.gl,data:n,target:this.gl.ELEMENT_ARRAY_BUFFER}),type:n instanceof Uint8Array?this.gl.UNSIGNED_BYTE:n instanceof Uint16Array?this.gl.UNSIGNED_SHORT:this.gl.UNSIGNED_INT,offset:0,count:n?n.length:0})}draw({mode:e=this.gl.TRIANGLES,elements:t=!!this.indices,count:n=t?this.indices.count:this.attributes.get("position").count,offset:a=this.indices?this.indices.offset:0,type:r=this.indices?this.indices.type:null,first:i=0,instanceCount:d=void 0}={}){t?d===void 0?this.gl.drawElements(e,n,r,a):this._drawElementsInstanced(e,n,r,a,d):d===void 0?this.gl.drawArrays(e,i,n):this._drawArraysInstanced(e,i,n,d)}}class Ne{constructor({near:e=.01,far:t=1e3,aspectRatio:n=1,fov:a=Ee/3}={}){this._near=e,this._far=t,this._aspectRatio=n,this._fov=a,this.transform=new Ce,this._inverseTransform=new Ce,this._projection=new Ce,this._projectionView=new Ce,this._updateProjection()}set near(e){this._near=e,this._updateProjection()}get near(){return this._near}set far(e){this._far=e,this._updateProjection()}get far(){return this._far}set fov(e){this._fov=e,this._updateProjection()}get fov(){return this._fov}set aspectRatio(e){this._aspectRatio=e,this._updateProjection()}get aspectRatio(){return this._aspectRatio}get inverseTransform(){return this._inverseTransform.invert(this.transform)}get projection(){return this._projection}get projectionView(){return this._projectionView.copy(this.projection).multiply(this.inverseTransform)}_updateProjection(){this._projection.fromPerspective(this)}}Object.defineProperty(Ne.prototype,"near",{enumerable:!0}),Object.defineProperty(Ne.prototype,"far",{enumerable:!0}),Object.defineProperty(Ne.prototype,"fov",{enumerable:!0}),Object.defineProperty(Ne.prototype,"aspectRatio",{enumerable:!0}),Object.defineProperty(Ne.prototype,"inverseTransform",{enumerable:!0}),Object.defineProperty(Ne.prototype,"projection",{enumerable:!0}),Object.defineProperty(Ne.prototype,"projectionView",{enumerable:!0});let Oe=new Map;class Ye extends Ae{static get TOUCH_TYPE(){return"touchtype"}static get MOUSE_TYPE(){return"mousetype"}static get(e=window){let t=Oe.get(e);return t||(t=new Ye(e)),t}get downed(){return this._downed}constructor(e=document.body){super(),this.domElement=e,this.type=Ye.TOUCH_TYPE,this.velocity=new Ae,this.dragOffset=new Ae,this.centered=new Ae,this.centeredFlippedY=new Ae,this.normalized=new Ae,this.normalizedFlippedY=new Ae,this.normalizedCentered=new Ae,this.normalizedCenteredFlippedY=new Ae,this._downed=!1,Oe.set(this.domElement,this),this.onDown=new xe,this.onMove=new xe,this.onUp=new xe,this.onClick=new xe,this.onTypeChange=new xe,this._preventMouseTypeChange=!1,this._onPointerMoveBinded=this._onPointerMove.bind(this),this._onPointerDownBinded=this._onPointerDown.bind(this),this._onPointerUpBinded=this._onPointerUp.bind(this),this._updateBinded=this._update.bind(this),this._resizeBinded=this.resize.bind(this),this.resize(),this._position=new Ae(this._domElementBoundingRect.left+.5*this._domElementBoundingRect.width,this._domElementBoundingRect.top+.5*this._domElementBoundingRect.height),this.enable()}resize(){this._domElementBoundingRect=this.domElement===window?{top:0,left:0,width:window.innerWidth,height:window.innerHeight}:this.domElement.getBoundingClientRect()}_onPointerDown(t){"touchstart"===t.type&&(this._preventMouseTypeChange=!0,this._changeType(Ye.TOUCH_TYPE)),this._downed=!0,this.dragOffset.set(0,0),this.copy(this._position),this._onPointerEvent(t),this._updatePositions(),this.onDown.dispatch(t)}_onPointerMove(t){if("mousemove"===t.type){if(this._preventMouseTypeChange)return;this._changeType(Ye.MOUSE_TYPE)}this._onPointerEvent(t),this.onMove.dispatch(t)}_onPointerUp(t){this._downed=!1,this._onPointerEvent(t),this._updatePositions(),this.onUp.dispatch(t),4>this.dragOffset.length&&this.onClick.dispatch(t),clearTimeout(this._timeout),this._timeout=setTimeout(()=>{this._preventMouseTypeChange=!1},2e3)}_onPointerEvent(t){!!window.TouchEvent&&t instanceof window.TouchEvent&&("touchend"===t.type?t=t.changedTouches[0]:t=t.touches[0]),this._position.x=t.clientX-this._domElementBoundingRect.left,this._position.y=t.clientY-this._domElementBoundingRect.top}_changeType(e){this.type===e||(this.type=e,this.disable(),this.enable(),this.onTypeChange.dispatch(this.type))}_update(){(this.x||this.y)&&(this.velocity.x=this._position.x-this.x,this.velocity.y=this._position.y-this.y,this.downed&&this.dragOffset.add(this.velocity)),this._updatePositions()}_updatePositions(){this.x=this._position.x,this.y=this._position.y,this.centered.x=this.centeredFlippedY.x=this.x-.5*this._domElementBoundingRect.width,this.centered.y=this.centeredFlippedY.y=this.y-.5*this._domElementBoundingRect.height,this.centeredFlippedY.y*=-1,this.normalized.x=this.normalizedFlippedY.x=this.x/this._domElementBoundingRect.width,this.normalized.y=this.normalizedFlippedY.y=this.y/this._domElementBoundingRect.height,this.normalizedFlippedY.y=1-this.normalizedFlippedY.y,this.normalizedCentered.x=this.normalizedCenteredFlippedY.x=2*this.normalized.x-1,this.normalizedCentered.y=this.normalizedCenteredFlippedY.y=2*this.normalized.y-1,this.normalizedCenteredFlippedY.y*=-1}enable(){this.disable(),this.resize(),this.type===Ye.TOUCH_TYPE?(this.domElement.addEventListener("touchmove",this._onPointerMoveBinded),window.addEventListener("touchend",this._onPointerUpBinded)):(this.domElement.addEventListener("mousedown",this._onPointerDownBinded),window.addEventListener("mouseup",this._onPointerUpBinded)),this.domElement.addEventListener("touchstart",this._onPointerDownBinded),this.domElement.addEventListener("mousemove",this._onPointerMoveBinded),window.addEventListener("resize",this._resizeBinded),ye.add(this._updateBinded=this._updateBinded||this._update.bind(this))}disable(){ye.delete(this._updateBinded),this.domElement.removeEventListener("touchstart",this._onPointerDownBinded),this.domElement.removeEventListener("mousedown",this._onPointerDownBinded),this.domElement.removeEventListener("touchmove",this._onPointerMoveBinded),this.domElement.removeEventListener("mousemove",this._onPointerMoveBinded),window.removeEventListener("touchend",this._onPointerUpBinded),window.removeEventListener("mouseup",this._onPointerUpBinded),window.removeEventListener("resize",this._resizeBinded)}}const je=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Ve=function(e,t){let n=t[0],a=t[1],r=t[2],i=t[3],d=n*n+a*a+r*r+i*i;return 0<d&&(d=1/fe(d),e[0]=n*d,e[1]=a*d,e[2]=r*d,e[3]=i*d),e},Ge=function(){let e=R(),t=A(1,0,0),n=A(0,1,0);return function(r,i,a){let d=O(i,a);return-.999999>d?(Y(e,t,i),1e-6>C(e)&&Y(e,n,i),N(e,e),de(r,e,Math.PI),r):.999999<d?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(Y(e,i,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+d,Ve(r,r))}}(),He=function(){let e=re(),n=re();return function(r,i,a,o,s,d){return me(e,i,s,d),me(n,a,o,d),me(r,e,n,2*d*(1-d)),r}}(),We=function(){let e=X();return function(t,n,a,r){return e[0]=a[0],e[3]=a[1],e[6]=a[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Ve(t,ce(t,e))}}();class Xe extends Float32Array{constructor(e=0,t=0,n=0,a=1){return super(4),this.set(e,t,n,a),this}get x(){return this[0]}set x(e){this[0]=e}get y(){return this[1]}set y(e){this[1]=e}get z(){return this[2]}set z(e){this[2]=e}get w(){return this[3]}set w(e){this[3]=e}identity(){return ie(this),this}set(e,t,n,a){return W(this,e,t,n,a),this}rotateX(e){return se(this,this,e),this}rotateY(e){return le(this,this,e),this}rotateZ(e){return _e(this,this,e),this}invert(e=this){return ue(this,e),this}copy(e){return je(this,e),this}normalize(e=this){return Ve(this,this),this}multiply(e,t){return t?oe(this,e,t):oe(this,this,e),this}fromMatrix3(e){return ce(this,e),this}}class Qe{constructor({matrix:e=new Ce,domElement:t=document.body,distance:n=0,invertRotation:a=!0,rotationEaseRatio:r=.04,zoomSpeed:i=.1,zoomEaseRatio:d=.1,minDistance:o=0,maxDistance:s=Infinity,enabled:l=!0}={}){this.matrix=e,this._distance=n,this.invertRotation=a,this.rotationEaseRatio=r,this.maxDistance=s,this.minDistance=o,this.zoomSpeed=i,this.zoomEaseRatio=d,this._pointer=Ye.get(t),this._nextDistance=this._distance,this._cachedQuaternion=new Xe,this._cachedMatrix=new Ce,this._cachedVector3=new ze,this._velocity=new Ae,this._velocityOrigin=new Ae,this._position=new ze([this.matrix.x,this.matrix.y,this.matrix.z]),this._positionPrevious=this._position.clone(),this._positionOffset=new ze,t.addEventListener("wheel",this.onWheel.bind(this)),this.enabled=!0,this.update(),this.enabled=l}set distance(e){this._distance=this._nextDistance=e}get distance(){return this._distance}onWheel(t){this.enabled&&(this._nextDistance+=t.deltaY*this.zoomSpeed,this._nextDistance=Math.max(ge(this._nextDistance,this.maxDistance),this.minDistance))}update(){this.enabled&&(this._cachedMatrix.identity(),this._cachedQuaternion.identity(),this._distance+=(this._nextDistance-this._distance)*this.zoomEaseRatio,this._position.set(this.matrix.x,this.matrix.y,this.matrix.z).subtract(this._positionOffset),this.matrix.x=0,this.matrix.y=0,this.matrix.z=0,this._pointer.downed&&this._velocity.copy(this._pointer.velocity).scale(.003),this._velocity.lerp(this._velocityOrigin,this.rotationEaseRatio),this._cachedQuaternion.rotateY(this.invertRotation?-this._velocity.x:this._velocity.x),this._cachedQuaternion.rotateX(this.invertRotation?-this._velocity.y:this._velocity.y),this._cachedMatrix.fromQuaternion(this._cachedQuaternion),this.matrix.multiply(this._cachedMatrix),this._positionOffset.set(0,0,1),this._positionOffset.applyMatrix4(this.matrix),this._positionOffset.scale(this._distance),this._cachedVector3.copy(this._position).add(this._positionOffset),this.matrix.x=this._cachedVector3.x,this.matrix.y=this._cachedVector3.y,this.matrix.z=this._cachedVector3.z)}}class qe{constructor({canvas:e}={}){this.canvas=e;const t={depth:!0,alpha:!1,antialias:!0};/\bforcewebgl1\b/.test(window.location.search)||(this.gl=this.canvas.getContext("webgl2",t)),this.gl||(this.gl=this.canvas.getContext("webgl",t)||this.canvas.getContext("experimental-webgl",t)),this.camera=new Ne,this.cameraController=new Qe({matrix:this.camera.transform,distance:5}),this.gl.clearColor(0,0,0,1),this.gl.enable(this.gl.CULL_FACE),this.gl.enable(this.gl.DEPTH_TEST),this.program=new Ue({gl:this.gl,uniforms:[["transform",new Ce]],vertexShaderChunks:[["start",`
          uniform mat4 projectionView;
          uniform mat4 transform;

          in vec3 normal;
          in vec3 position;

          out vec3 vNormal;
        `],["end",`
          gl_Position = projectionView * transform * vec4(position, 1.);
          vNormal = normal;
        `]],fragmentShaderChunks:[["start",`
          precision highp float;

          in vec3 vNormal;
        `],["end",`
          fragColor = vec4(vNormal * .5 + .5, 1.);
        `]]}),this.mesh=new ke({gl:this.gl,attributes:[["position",{data:new Float32Array([-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5]),size:3}],["normal",{data:new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,-1,0,0,-1,0,0,-1,0,0,-1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0]),size:3}]],indiceData:new Uint8Array([0,2,3,0,3,1,4,6,7,4,7,5,8,10,11,8,11,9,12,14,15,12,15,13,16,18,19,16,19,17,20,22,23,20,23,21])})}resize(e,t){this.camera.aspectRatio=e/t,this.update()}update(){this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.cameraController.update(),this.program.use(),this.program.uniforms.set("projectionView",this.camera.projectionView),this.program.attributes.set(this.mesh.attributes),this.mesh.indices.buffer.bind(),this.mesh.draw()}}const Ke=Promise.all([Be.load({value:"src/main/template.html",type:"template"}),Be.load("src/main/index.css")]);window.customElements.define("dnit-main",class extends be{connectedCallback(){super.connectedCallback(),Ke.then(([e])=>{let t=document.importNode(e.content,!0);this.appendChild(t),this.canvas=this.querySelector("canvas"),this.view=new qe({canvas:this.canvas}),window.addEventListener("resize",this._resizeBinded=this.resize.bind(this)),this.resize(),this.play()})}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("resize",this._resizeBinded)}resize(){let e=this.canvas.offsetWidth,t=this.canvas.offsetHeight;this.canvas.width=e*window.devicePixelRatio,this.canvas.height=t*window.devicePixelRatio,this.view.resize(e,t)}update(){this.view.update()}})})();